// Generated by CoffeeScript 1.9.3
(function() {
  var CASE_SENSITIVE, is_exports, load, locale, localizedText, low, root, setLocale, translate;

  is_exports = typeof exports !== "undefined" && exports !== null;

  root = is_exports ? exports : this;

  if (!root.sup) {
    root.sup = {};
  }

  sup.localizedDict = {};

  localizedText = {};

  locale = null;

  CASE_SENSITIVE = false;

  low = function(str) {
    if (!CASE_SENSITIVE) {
      return str.toLowerCase();
    }
    return str;
  };

  load = function(loc_text_list) {
    var i, len, loc_text_dict, text;
    if (!(loc_text_list instanceof Array)) {
      return {};
    }
    loc_text_dict = {};
    for (i = 0, len = loc_text_list.length; i < len; i++) {
      text = loc_text_list[i];
      if (text.msgid && text.msgstr) {
        loc_text_dict[low(text.msgid)] = text.msgstr;
      }
    }
    return loc_text_dict;
  };

  setLocale = function(loc) {
    var k, locale_dict, ref, v;
    locale = null;
    loc = loc.replace('-', '_');
    ref = sup.localizedDict;
    for (k in ref) {
      v = ref[k];
      if (k.toLowerCase() === loc.toLowerCase()) {
        locale = k;
        break;
      }
    }
    if (locale && sup.localizedDict[locale]) {
      locale_dict = sup.localizedDict[locale];
    } else {
      locale_dict = null;
    }
    localizedText = load(locale_dict);
    locale = locale;
    return locale;
  };

  translate = function(text) {
    var arg, args, i, j, len, len1, ref, trans;
    if (typeof text !== 'string') {
      return text;
    }
    trans = localizedText[low(text)];
    if (!trans) {
      trans = text;
    }
    args = [];
    for (i = 0, len = arguments.length; i < len; i++) {
      arg = arguments[i];
      args.push(arg);
    }
    ref = args.slice(1);
    for (j = 0, len1 = ref.length; j < len1; j++) {
      arg = ref[j];
      if (arg === void 0) {
        arg = '';
      }
      trans = trans.replace("%s", arg);
    }
    return trans;
  };

  angular.module('supLocale', ['ngCookies']).run([
    'supLocale', function(supLocale) {
      return supLocale.init();
    }
  ]).service("supLocale", [
    '$rootScope', '$cookieStore', function($rootScope, $cookieStore) {
      var default_locale, self;
      default_locale = 'en_US';
      self = this;
      this.init = function(loc, case_sensitive) {
        var cookieLocale, currLocale, e, userLang, userLocale;
        CASE_SENSITIVE = Boolean(case_sensitive);
        if (loc) {
          default_locale = loc;
        }
        userLang = navigator.language || navigator.userLanguage;
        userLocale = userLang.replace('-', '_');
        try {
          cookieLocale = $cookieStore.get('current_locale');
        } catch (_error) {
          e = _error;
          cookieLocale = null;
        }
        currLocale = cookieLocale ? cookieLocale : userLocale;
        self.set(currLocale);
        return $rootScope._ = angular.translate = translate;
      };
      this.translate = function(args) {
        return translate.apply(this, arguments);
      };
      this.set = function(loc) {
        locale = setLocale(loc);
        locale = locale || default_locale;
        $rootScope.locale = locale;
        $rootScope.lang = locale.split('_')[0] || 'en';
        return $cookieStore.put('current_locale', locale);
      };
      this.get = function() {
        var cookieLocale, e;
        try {
          cookieLocale = $cookieStore.get('current_locale');
        } catch (_error) {
          e = _error;
          cookieLocale = null;
        }
        return cookieLocale;
      };
      this.match = function(lang1, lang2) {
        lang1 = lang1.replace('-', '_');
        lang2 = lang2.replace('-', '_');
        return lang1.toLowerCase() === lang2.toLowerCase();
      };
      return this;
    }
  ]);

}).call(this);
